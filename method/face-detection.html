<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Face Detection</title>
    <style>
      .videoElement {
        width: 500px;
        height: 375px;
        background-color: #666;
      }
    </style>

    <!-- panggil css -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  </head>

  <body>
    <div class="content">
      <a class="btn btn-primary" href="/index.html" role="button">Kembali</a><br>

      <div class="text-center">
        <h3>Face Detection</h3>
  
        <a class="btn btn-danger" role="button" onclick="startVideo()">Open Camera</a><br>
        <video autoplay muted id="videoElement"></video><br>
        
        <p>Sumber: https://developers.google.com/web/ilt/pwa/introduction-to-push-notifications</p>
      </div>      
    </div>

    <!-- method -->
    <script>      
      var video = document.querySelector("#videoElement");

      Promise.all([
        faceapi.nets.tinyFaceDetector.loadFromUri('/library/face-api/models'),
        faceapi.nets.faceLandmark68Net.loadFromUri('/library/face-api/models'),
        faceapi.nets.faceRecognitionNet.loadFromUri('/library/face-api/models'),
        faceapi.nets.faceExpressionNet.loadFromUri('/library/face-api/models')
      ]).then(startVideo)

      function startVideo() {
        navigator.mediaDevices.getUserMedia(
          { video: {} },
          stream => video.srcObject = stream,
          err => console.error(err)
        )
      }

      video.addEventListener('play', () => {
        const canvas = faceapi.createCanvasFromMedia(video)
        document.body.append(canvas)
        const displaySize = { width: video.width, height: video.height }
        faceapi.matchDimensions(canvas, displaySize)
        setInterval(async () => {
          const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions()
          const resizedDetections = faceapi.resizeResults(detections, displaySize)
          canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)
          faceapi.draw.drawDetections(canvas, resizedDetections)
          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections)
          faceapi.draw.drawFaceExpressions(canvas, resizedDetections)
        }, 100)
      })
    </script>

    <!-- Javascript Support -->
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  </body>
</html>